name: ETL

on:
  schedule:
  - cron: "0 8 * * *" # Every day at 8am
  - cron: "0 8 * * MON"  # Every Monday at 8am
  - cron: "0 8 1 * *" # Every 1st of the month at 8am

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1

    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: 3.7

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install --upgrade poetry
        poetry install

    - name: Run weekly ETL
      if: github.event.schedule == '0 8 * * MON'
      run: |-
        poetry run python canadian-municipalities/scrape.py

    - name: Create PR of changes
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: Updating datasets
        title: Updating the datasets
        body: >
          This PR was auto-generated by the slothful-myles ETL.
